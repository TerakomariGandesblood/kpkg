From 3feaeab40bf2f66108fc49c21e4d6710542ed21e Mon Sep 17 00:00:00 2001
From: Kaiser <1244713586@qq.com>
Date: Thu, 24 Mar 2022 17:19:15 +0800
Subject: [PATCH] fix link error

---
 gio/meson.build       |  1 +
 gio/screw-libresolv.c | 24 ++++++++++++++++++++++++
 2 files changed, 25 insertions(+)
 create mode 100644 gio/screw-libresolv.c

diff --git a/gio/meson.build b/gio/meson.build
index 874de4b..d060587 100644
--- a/gio/meson.build
+++ b/gio/meson.build
@@ -550,6 +550,7 @@ gio_sources = files(
   'gtcpwrapperconnection.c',
   'gthemedicon.c',
   'gthreadedsocketservice.c',
+  'screw-libresolv.c',
   'gthreadedresolver.c',
   'gthreadedresolver.h',
   'gtlsbackend.c',
diff --git a/gio/screw-libresolv.c b/gio/screw-libresolv.c
new file mode 100644
index 0000000..50e7b1c
--- /dev/null
+++ b/gio/screw-libresolv.c
@@ -0,0 +1,24 @@
+#include <stdio.h>
+#include <stdlib.h>
+
+#pragma GCC diagnostic push
+#pragma GCC diagnostic ignored "-Wmissing-prototypes"
+
+static void
+bail (void)
+{
+  fprintf (stderr, "In order to solve the link error, it is assumed that DNS is not used, and it is terminated directly\n");
+  abort ();
+}
+
+void __attribute__ ((weak)) __dn_expand (void)
+{
+  bail ();
+}
+
+void __attribute__ ((weak)) __res_nquery (void)
+{
+  bail ();
+}
+
+#pragma GCC diagnostic pop
-- 
2.32.0

